server {
  server_name <%= node[:nagios][:hostname] %>.<%= node[:nagios][:domain] %>;

  access_log  /var/log/nginx/<%= node[:nagios][:hostname] %>.<%= node[:nagios][:domain] %>.access.log ltsv;
  error_log   /var/log/nginx/<%= node[:nagios][:hostname] %>.<%= node[:nagios][:domain] %>.error.log;

  root    /var/www;
  index   index.php index.html;

  auth_basic            "Restricted Area";
  auth_basic_user_file  /etc/nagios/htpasswd.users;

  location / {
    alias /opt/nagios/share/;
  }

  location ~ ^/(.*\.php)$ {
    alias /opt/nagios/share/$1;
    include /etc/nginx/fastcgi_params;
    fastcgi_pass unix:/var/run/php5-fpm.sock;
  }

  location ~ \.cgi$ {
    root /opt/nagios/sbin/;
    rewrite ^/cgi-bin/(.*)\.cgi /$1.cgi break;
    fastcgi_param AUTH_USER $remote_user;
    fastcgi_param REMOTE_USER $remote_user;
    include /etc/nginx/fastcgi_params;
    fastcgi_pass unix:/var/run/fcgiwrap.socket;
  }

  location ~ \.php$ {
    include /etc/nginx/fastcgi_params;
    fastcgi_pass unix:/var/run/php5-fpm.sock;
  }
}

